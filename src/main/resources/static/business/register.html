<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
    <div id="app">
        <el-container>
            <el-header>
                <h3>欢迎物流商入驻</h3>
            </el-header>
            <el-main >

                <el-steps :active="active" finish-status="success" simple>
                    <el-step title="会员注册"></el-step>
                    <el-step title="提交资料"></el-step>
                    <el-step title="签订协议"></el-step>
                    <el-step title="入驻成功"></el-step>
                </el-steps>

                <el-row style="margin-top: 20px">
                    <el-col :span="16" :offset="4">
                        <el-form ref="form" :model="form" label-width="200px">
                            <template v-if="active==0">
                                <el-form-item label="用户名">
                                    <el-input v-model="form.account" placeholder="用于登录九尾狐物流商平台"></el-input>
                                </el-form-item>
                                <el-form-item label="密码" prop="pass">
                                    <el-input type="password" v-model="form.pass" auto-complete="off"></el-input>
                                </el-form-item>
                                <el-form-item label="确认密码" prop="checkPass">
                                    <el-input type="password" v-model="form.checkPass" auto-complete="off"></el-input>
                                </el-form-item>
                                <el-form-item label="物流企业名">
                                    <el-input v-model="form.eptname" placeholder="请输入名称"></el-input>
                                </el-form-item>
                                <el-form-item label="联系人">
                                    <el-input v-model="form.contact" placeholder="请输入联系人"></el-input>
                                </el-form-item>
                                <el-form-item label="联系电话">
                                    <el-input v-model="form.mobile"></el-input>
                                </el-form-item>
                                <el-form-item label="QQ账号">
                                    <el-input v-model="form.qq"></el-input>
                                </el-form-item>
                                <el-form-item label="公司类型">
                                    <el-select v-model="form.eptType">
                                        <el-option label="国际快递" value="international"></el-option>
                                    </el-select>
                                </el-form-item>
                            </template>
                            <template v-if="active==1">
                                <el-form-item label="营业执照(三证合一)">
                                    <el-upload
                                            class="upload-demo"
                                            ref="upload"
                                            action="/business/regist/upload"
                                            :on-preview="handlePreview"
                                            :on-remove="handleRemove"
                                            :on-success="handleSuccess"
                                            :file-list="form.license"
                                            :auto-upload="true"
                                            :limit="1"
                                            :data="{'id':form.account,'field':'license'}">
                                        <el-button slot="trigger" size="small" type="primary">上传文件</el-button>
                                    </el-upload>
                                </el-form-item>

                                <el-form-item label="道路运输许可证">
                                    <el-upload
                                            class="upload-demo"
                                            ref="upload"
                                            action="/business/regist/upload"
                                            :on-preview="handlePreview"
                                            :on-remove="handleRemove"
                                            :on-success="handleSuccess"
                                            :file-list="form.transportPermission"
                                            :auto-upload="true"
                                            :limit="1"
                                            :data="{'id':form.account,'field':'transportPermission'}">
                                        <el-button slot="trigger" size="small" type="primary">上传文件</el-button>
                                    </el-upload>
                                </el-form-item>

                            </template>
                            <template v-if="active==2">
                                <h3>物流商入驻服务协议</h3>
                            </template>
                            <template v-if="active==3">
                                请点击完成
                            </template>
                            <template v-if="active==4">
                                恭喜你完成入驻,请等待审核
                            </template>
                        </el-form>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="4" :offset="12" v-if="active <=3">
                        <el-button style="margin-top: 12px;" @click="prev">上一步</el-button>
                        <el-button style="margin-top: 12px;" @click="next"  type="primary" v-if="active <3">下一步</el-button>
                        <el-button style="margin-top: 12px;" @click="onSubmit"  type="primary" v-if="active >=3" >完成</el-button>
                    </el-col>
                </el-row>
            </el-main>
        </el-container>
    </div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script src="https://unpkg.com/axios/dist/axios.js"></script>
<script>
    var data= {
        active:0,
        form: {
            account: '',
            eptname: '',
            contact: '',
            mobile: '',
            qq: '',
            eptType: ''
        }
    };

    new Vue({
        el: '#app',
        data: data,
        methods: {
            next() {
                if (this.active++ > 3) this.active = 3;
            },
            prev(){
                if(this.active-- < 0) this.active = 0;
            },
            submitUpload() {
                this.$refs.upload.submit();
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            onSubmit() {
                //debugger;
                console.log('submit!');
                var v = this;
                axios.post('/business/regist/create', {
                    account:data.form.account,
                    password:data.form.pass,
                    eptname:data.form.eptname,
                    contact:data.form.contact,
                    mobile:data.form.mobile,
                    qq:data.form.qq,
                    eptType:data.form.eptType,
                    license:data.form.license,
                    transportPermission:data.form.transportPermission
                })
                    .then(function (response) {
                        console.log(response);
                        v.$message({
                            message: '注册成功',
                            type: 'success'
                        });
                        // setTimeout(function(){
                        //     window.location.href="/business/login.html";
                        // },1000);
                        if (data.active++ > 3) data.active = 4;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            handleSuccess(response, file, fileList){
                console.log(response);
                if(response.code == 1){
                    if(response.type == 'license'){
                        data.form.license = response.url;
                    }else if(response.type == 'transportPermission'){
                        data.form.transportPermission = response.url;
                    }
                }

            }
        }
    })
</script>
</html>